<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper
  	namespace="com.myboard.myapp.user.dao.face.UserDao">
  	
  <select id="isUser" parameterType="User" resultType="int">
  	SELECT count(*) FROM user_tb 
  	WHERE user_id = #{userId} AND user_pw = #{userPw}
  </select>	
  
  <select id="getUserInfo" parameterType="User"
  	resultType="User">
  	SELECT user_no, user_nick FROM user_tb 	
  	WHERE user_id = #{userId} AND user_pw = #{userPw}
  </select>
  
  <select id="getUser" parameterType="int" resultType="User">
  	SELECT * FROM user_tb WHERE user_no = #{userNo}
  </select>

	<select id="getCntBoard" parameterType="int" resultType="int">
		SELECT count(*) FROM board WHERE user_no = #{userNo}
	</select>
	
	<select id="getBoardList" parameterType="Map" resultType="Map">
		SELECT * FROM
    	(select rownum rnum, b.*
        FROM(
        SELECT title, board_no, write_date, hit
        ,(SELECT count(*) FROM  board_comment bc WHERE bc.board_no = b.board_no
        ) commentCnt
        FROM board b
        WHERE user_no = #{userNo}
        order by board_no DESC
        ) b
        order by rnum
        )WHERE rnum BETWEEN #{paging.startNo} and #{paging.endNo}
	</select>
	
	<insert id="insertUserFile" parameterType="UserFile">
		INSERT INTO userfile 
		(user_no,
		 userfile_no,
		 userfile_stored)
		VALUES
		(#{userNo},
		 userfile_no_seq.nextval,
		 #{userfileStored}
		)
	</insert>
	
	<select id="getUserProfile" parameterType="int" resultType="UserFile">
		SELECT * FROM userfile WHERE user_no = #{userNo}
	</select>

	<insert id="joinUser" parameterType="User">
		INSERT INTO user_tb
		(user_no,
		 user_name,
		 user_id,
		 user_pw,
		 user_nick,
		 user_gender,
		 user_birth,
		 user_email,
		 user_phone)
		 VALUES
		 (user_no_seq.nextval,
		  #{userName},
		  #{userId},
		  #{userPw},
		  #{userNick},
		  #{userGender},
		  #{userBirth},
		  #{userEmail},
		  #{userPhone}
		 )
	</insert>
	
	<update id="updateUser" parameterType="User">
		UPDATE user_tb SET
		user_name = #{userName},
		user_nick = #{userNick},
		user_pw = #{userPw},
		user_email = #{userEmail},
		user_phone = #{userPhone},
		user_postcode = #{userPostcode},
		user_addr1 = #{userAddr1},
		user_addr2 = #{userAddr2},
		user_addr3 = #{userAddr3}
		WHERE user_no = #{userNo}
	</update>
	
  	<delete id="deleteUserFile" parameterType="int">
  		DELETE FROM userfile WHERE user_no = #{userNo}
  	</delete>
  	
  	<select id="getCommCnt" parameterType="int" resultType="int">
  		SELECT count(*) FROM board_comment WHERE user_no = #{userNo}
  	</select>
  </mapper>